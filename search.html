<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>K·∫øt qu·∫£ t√¨m ki·∫øm</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">

<header class="sticky top-0 z-[1000] bg-white shadow-md px-4 py-2 flex flex-wrap items-center justify-between gap-2">
    <!-- Logo -->
    <div class="logo">
        <a href="trangchu.html">
            <img src="images/logo1.jpg" alt="logo ABC Babyshop" class="w-[134px] h-auto block" />
        </a>
    </div>

    <!-- Menu ch√≠nh -->
    <nav class="flex flex-wrap items-center gap-4 text-sm">
        <!-- Dropdown: B√© g√°i -->
        <div class="relative group">
            <a href="category.html?category_id=1" class="text-blue-600 font-bold px-4 py-2 hover:text-[#01579B]">B√© g√°i</a>
            <div class="absolute hidden group-hover:block bg-white shadow-lg rounded-md min-w-[200px] z-50">
                <a href="category.html?category_id=5" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">V√°y ƒë·∫ßm b√© g√°i</a>
                <a href="category.html?category_id=6" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">√Åo b√© g√°i</a>
                <a href="category.html?category_id=7" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">√Åo kho√°c b√© g√°i</a>
                <a href="category.html?category_id=8" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">Qu·∫ßn tr·∫ª em g√°i</a>
                <a href="category.html?category_id=9" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">ƒê·ªì b·ªô b√© g√°i</a>
                <a href="category.html?category_id=10" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">ƒê·ªì b∆°i b√© g√°i</a>
            </div>
        </div>
        <!-- Dropdown: B√© trai -->
        <div class="relative group">
            <a href="category.html?category_id=2" class="text-blue-600 font-bold px-4 py-2 hover:text-[#01579B]">B√© trai</a>
            <div class="absolute hidden group-hover:block bg-white shadow-lg rounded-md min-w-[200px] z-50">
                <a href="category.html?category_id=11" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">√Åo thun b√© trai</a>
                <a href="category.html?category_id=12" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">√Åo s∆° mi b√© trai</a>
                <a href="category.html?category_id=13" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">√Åo kho√°c b√© trai</a>
                <a href="category.html?category_id=14" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">Qu·∫ßn ki·ªÉu b√© trai</a>
                <a href="category.html?category_id=15" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">Qu·∫ßn jeans b√© trai</a>
                <a href="category.html?category_id=16" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">ƒê·ªì b·ªô b√© trai</a>
                <a href="category.html?category_id=17" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">ƒê·ªì b∆°i b√© trai</a>
                <a href="category.html?category_id=18" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">Qu·∫ßn l√≥t b√© trai</a>
                <a href="category.html?category_id=19" class="block px-4 py-2 text-black hover:bg-[#81D4FA]">Ph·ª• ki·ªán b√© trai</a>
            </div>
        </div>
        <a href="category.html?category_id=3" class="text-blue-600 font-bold px-4 py-2 hover:text-[#01579B]">ƒê·ªì d√πng m·∫π v√† b√©</a>
        <a href="category.html?category_id=4" class="text-blue-600 font-bold px-4 py-2 hover:text-[#01579B]">Tr·∫ª em</a>
    </nav>

    <div class="flex items-center w-[250px] rounded-full bg-white border border-[#81D4FA] px-4 py-2 shadow transition-all duration-300 focus-within:w-[550px]">
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." class="flex-1 outline-none border-none text-[16px] bg-transparent placeholder:text-gray-400" />
        <button onclick="searchProducts()" class="hover:text-[#0288D1]">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 fill-[#333] hover:fill-[#0288D1]" viewBox="0 0 512 512">
                <path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/>
            </svg>
        </button>
    </div>

    <!-- T√†i kho·∫£n -->
    <div class="user-account relative inline-block" id="userAccount"></div>
    <script src="js/acc.js"></script>

    <!-- Th√¥ng b√°o -->
    <div class="nav-item relative">
        <a href="#" id="notification-icon" class="relative" onclick="toggleNotifications(event)">
            <button class="bg-white text-black p-2 text-lg border-none rounded-md cursor-pointer transition-all duration-300 hover:bg-blue-500" aria-label="Th√¥ng b√°o">
                <span class="text-xl" style="font-size: 1.5rem;">üîî</span>
            </button>
            <span id="unreadCount" class="bg-red-500 text-white text-xs rounded-full px-2 py-1 absolute top-0 right-0 hidden"></span>
        </a>
        <div id="notification-dropdown" class="hidden absolute bg-white shadow-lg p-4 rounded-lg w-64 mt-2 z-50 right-0">
            <ul id="notification-list" class="text-black"></ul>
        </div>
    </div>
    <script src="js/thongbao.js"></script>

    <!-- Gi·ªè h√†ng -->
    <div class="header-icons flex gap-2">
        <a href="#">
            <button onclick="toggleCart()" class="cart-btn bg-white text-black p-2 text-lg border-none rounded-md cursor-pointer transition-all duration-300 hover:bg-blue-500" aria-label="Gi·ªè h√†ng">
                <span class="text-xl" style="font-size: 1.5rem;">üõí</span>
            </button>
        </a>
    </div>
</header>

<div class="container mx-auto p-4">
    <div class="mb-6">
        <select class="border rounded p-2 w-full sm:w-1/4" id="sortSelect" onchange="searchProducts()">
            <option value="default">M·∫∑c ƒë·ªãnh</option>
            <option value="T√™n A ‚Üí Z">T√™n A ‚Üí Z</option>
            <option value="T√™n Z ‚Üí A">T√™n Z ‚Üí A</option>
            <option value="Gi√° tƒÉng d·∫ßn">Gi√° tƒÉng d·∫ßn</option>
            <option value="Gi√° gi·∫£m d·∫ßn">Gi√° gi·∫£m d·∫ßn</option>
            <option value="H√†ng m·ªõi">H√†ng m·ªõi</option>
        </select>
    </div>

    <span id="searchQuery" class="text-gray-700 text-lg font-medium"></span>

    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông t·∫°i ƒë√¢y -->
    </div>
</div>

<footer class="bg-gray-800 text-white p-6 text-center fixed bottom-0 w-full">
    <p>BABY Store - Th·ªùi trang tr·∫ª em</p>
    <p>ƒêi·ªán tho·∫°i: 0123456789</p>
    <p>ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng ABC, H√† N·ªôi</p>
</footer>

<div class="chat-container fixed bottom-5 right-5 z-50">
    <div class="chat-icon w-12 h-12 bg-blue-500 text-white text-xl flex items-center justify-center rounded-full shadow-lg cursor-pointer transform transition-all duration-300 hover:bg-blue-600 hover:scale-110" onclick="toggleChat()">üí¨</div>
    <div class="chat-box fixed bottom-20 right-5 w-72 bg-white rounded-lg shadow-lg overflow-hidden flex flex-col hidden" id="chatBox">
        <div class="chat-header bg-blue-200 text-black p-4 flex justify-between items-center font-bold">
            <span>üí¨ H·ªó tr·ª£ kh√°ch h√†ng</span>
            <button class="close-btn text-white text-xl" onclick="toggleChat()" aria-label="ƒê√≥ng chat">‚ùå</button>
        </div>
        <div class="chat-body bg-blue-100 p-4 flex flex-col gap-4 h-64 overflow-y-auto" id="chatBody">
            <p><strong>Bot:</strong> Xin ch√†o! B·∫°n c·∫ßn h·ªó tr·ª£ g√¨?</p>
        </div>
        <div class="chat-input flex p-4 bg-blue-100">
            <input type="text" id="userInput" placeholder="Nh·∫≠p c√¢u h·ªèi..." class="flex-1 p-2 rounded-lg border-none outline-none" aria-label="Nh·∫≠p c√¢u h·ªèi">
            <button onclick="sendMessage()" class="bg-blue-300 text-black p-2 rounded-lg ml-2 cursor-pointer hover:bg-blue-400" aria-label="G·ª≠i tin nh·∫Øn">G·ª≠i</button>
        </div>
        <div class="chat-links flex justify-between items-center p-4 gap-4">
            <a href="https://m.me/yourpage" target="_blank" class="flex bg-blue-200 text-black p-2 rounded-lg justify-center items-center hover:bg-blue-300">
                <img src="images/messenger.webp" alt="Chat Messenger" class="mr-2 w-8 h-8"> Messenger
            </a>
            <a href="https://chat.zalo.me/" target="_blank" class="flex bg-blue-200 text-black p-2 rounded-lg justify-center items-center hover:bg-blue-300">
                <img src="images/addthis-zalo.svg" alt="Chat Zalo" class="mr-2 w-8 h-8"> Zalo
            </a>
        </div>
    </div>
</div>
<script src="js/chat.js"></script>

<script>
async function searchProducts() {
    const query = document.getElementById('searchInput').value;
    const sortBy = document.getElementById('sortSelect').value;

    if (!query.trim()) {
        document.getElementById('productGrid').innerHTML = '<p class="text-center text-gray-500">Vui l√≤ng nh·∫≠p t·ª´ kh√≥a t√¨m ki·∫øm.</p>';
        return;
    }

    try {
        // G·ªçi API ƒë·ªÉ l·∫•y k·∫øt qu·∫£ t√¨m ki·∫øm
        const response = await fetch(`PHP/search_data.php?query=${encodeURIComponent(query)}&sort_by=${encodeURIComponent(sortBy)}`);
        const data = await response.json();

        const productGrid = document.getElementById('productGrid');
        productGrid.innerHTML = '';

        if (data.products.length > 0) {
            // Hi·ªÉn th·ªã danh s√°ch s·∫£n ph·∫©m
            productGrid.innerHTML = data.products.map(product => `
                <div class="bg-white shadow-lg rounded-lg p-4">
                    <a href="product_detail.php?product_id=${product.product_id}">
                        <img src="${product.image_url.split(',')[0]}" alt="${product.name}" class="w-full h-auto rounded-lg mb-4" />
                    </a>
                    <h3 class="text-lg font-semibold text-gray-800 mt-4">
                        <a href="product_detail.php?product_id=${product.product_id}" class="hover:text-blue-600">
                            ${product.name}
                        </a>
                    </h3>
                    <p class="text-lg font-semibold text-blue-600"> Gi√° gi·∫£m:
                        ${new Intl.NumberFormat('vi-VN').format(product.discount_price)}‚Ç´
                        <del class="text-gray-500 text-sm ml-2">${new Intl.NumberFormat('vi-VN').format(product.price)}‚Ç´</del>
                    </p>
                    <p class="mt-4">
                    <a href="product_detail.html?product_id=${product.product_id}" class="text-blue-600 hover:underline font-semibold transition-colors duration-300 hover:text-blue-800">
                        Xem chi ti·∫øt
                    </a>
                </div>
            `).join('');
        } else {
            // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu kh√¥ng c√≥ s·∫£n ph·∫©m
            productGrid.innerHTML = '<p class="text-center text-gray-500">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p.</p>';
        }
    } catch (error) {
        document.getElementById('productGrid').innerHTML = '<p class="text-center text-red-500">ƒê√£ x·∫£y ra l·ªói khi t√¨m ki·∫øm s·∫£n ph·∫©m.</p>';
        console.error(error);
    }
}

// G·ªçi khi t·∫£i trang n·∫øu c√≥ query tr√™n URL
document.addEventListener('DOMContentLoaded', async function () {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('query');
    const sortBy = urlParams.get('sort_by') || 'default';

    if (query) {
        document.getElementById('searchInput').value = query;
        document.getElementById('sortSelect').value = sortBy;
        await searchProducts();
    }
});
</script>
</body>
</html>